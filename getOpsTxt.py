import re
import pandas as pd

def getOps(filepath):
    f = open(filepath)
    ops = []
    p = re.compile(r'\s([a-fA-f0-9]{2}\s)+\s*([a-z]+)')
    for line in f:
        if line.startswith(".text"):
            m = re.findall(p, line)
            if m:
                opcode = m[0][1]
                if opcode != "align":
                    ops.append(opcode)
    return ops

def getNorOps(filepath):
    f = open(filepath)
    ops = []
    p = re.compile(r'[0-9A-F]+\s+([a-z]+)\s+')
    for line in f:
        if line.startswith(".text") or line.startswith("CODE:"):
            m = re.findall(p, line)
            if m:
                opcode = m[0]
                if opcode != "align":
                    ops.append(opcode)
    return ops

baseDir = "E:/normalsoftwares/asms_cp/"
targDir = "E:/normalsoftwares/asmops_cp/"

trainOpsLen = []
count = 0
for index in range(11,12):
    filepath = baseDir + "zzasm(" + str(index) +").asm"
    ops = getNorOps(filepath)
    count += 1
    print "getting from file", index, "...", ops
    targFilepath = targDir + "zzasm(" + str(index) +").txt"
    f = open(targFilepath, "w")
    for op in ops:
        print >> f, op
    trainOpsLen.append(["", len(ops)])
    f.close()
    print len(ops)

# trainOpsLendf = pd.DataFrame(trainOpsLen, columns=["Id", "opsLen"])
# trainOpsLendf.to_csv("E:/normalsoftwares/opsLen_cp.csv")