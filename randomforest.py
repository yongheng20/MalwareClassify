import pandas as pd
from sklearn import cross_validation
from sklearn.ensemble import RandomForestClassifier as RFC
import numpy as np
import time

labels = pd.read_csv("E:/msmalware/subtrain40labelsClean_3gram.csv")
features = pd.read_csv("E:/msmalware/subtrain40featuresVar100More_3gram.csv")
train = pd.merge(labels, features, on="Id")

labels = train.Class
train.drop(["Id", "Class"], axis=1, inplace=True)
train = train.as_matrix()

f = open("E:/log.txt", "a")
print >> f, ""
print >> f, time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(time.time()))
print >> f, "[all train set, malware classify] [opcode 3 gram] [select features variance more than 64, count 1113] [test size=0.3] [randomforest classifier with 100 trees]"
f.close()

list = []
n=50
for i in range(n):
    X_train, X_test, y_train, y_test = cross_validation.train_test_split(train, labels, test_size=0.3)
    rfc = RFC(n_estimators=100, n_jobs=-1)
    rfc.fit(X_train, y_train)
    score = rfc.score(X_test, y_test)
    list.append(score)

f = open("E:/log.txt", "a")
avg = np.mean(list)
for i in range(len(list)):
    list[i] = round(list[i], 4)
print >> f, "scores in", len(list), "rounds:", list
print >> f, "avg score:", round(avg, 5)
print >> f, time.strftime("End time: %Y-%m-%d %H:%M:%S", time.localtime(time.time()))
f.close()