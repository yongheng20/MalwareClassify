import pandas as pd
from sklearn import cross_validation
from sklearn.ensemble import RandomForestClassifier as RFC
import numpy as np
import time

labels = pd.read_csv("E:/msmalware/subtrain40labels2.csv")
features = pd.read_csv("E:/msmalware/subtrain40v2features200timesup_3gram.csv")
train = pd.merge(labels, features, on="Id")

labels = train.Class
train.drop(["Id", "Class"], axis=1, inplace=True)
train = train.as_matrix()

f = open("E:/log.txt", "a")
print >> f, ""
print >> f, time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(time.time()))
print >> f, "[sub40 v2, malware classify] [opcode 3 gram] [select features 200 times up, count 1526] [test size=0.3] [randomforest classifier with 100 trees]"
f.close()

scoreList = []
n = 50
for i in range(n):
    X_train, X_test, y_train, y_test = cross_validation.train_test_split(train, labels, test_size=0.3)
    rfc = RFC(n_estimators=100, n_jobs=-1)
    rfc.fit(X_train, y_train)
    scoreList.append(rfc.score(X_test, y_test))

f = open("E:/log.txt", "a")
avg = np.mean(scoreList)
for i in range(len(scoreList)):
    scoreList[i] = round(scoreList[i], 4)
print >> f, "scores in", len(scoreList), "rounds:", scoreList
print >> f, "avg score:", round(avg, 5)
print >> f, time.strftime("End time: %Y-%m-%d %H:%M:%S", time.localtime(time.time()))
f.close()
